<div
  class="card bg-white border border-slate-200 rounded-xl shadow-sm p-6"
  dir="rtl"
>
  <h3 class="font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
    <i class="pi pi-history text-slate-400"></i>
    سجل النشاطات (Activity Log)
  </h3>

  <p-timeline [value]="logs" align="right" styleClass="w-full">
    <ng-template pTemplate="marker" let-log>
      <div class="flex flex-col items-center z-10">
        @if (log.loggerPictureUrl != null && log.loggerPictureUrl != ""){
        <p-avatar
          [image]="getPictureUrl(log.loggerPictureUrl)"
          shape="circle"
          size="large"
          styleClass="border-2 border-white shadow-md"
          [style]="{ 'background-color': '#f1f5f9', color: '#475569' }"
        >
        </p-avatar>
        } @else {
        <p-avatar
          [label]="getInitials(log.loggerName)"
          shape="circle"
          size="large"
          styleClass="border-2 border-white shadow-md"
          [style]="{ 'background-color': '#f1f5f9', color: '#475569' }"
        >
        </p-avatar>
        }
      </div>
    </ng-template>

    <ng-template pTemplate="content" let-log>
      <div class="mr-4 mb-8 min-w-[150px]">
        <div
          class="bg-slate-50 border border-slate-100 rounded-lg p-4 relative hover:shadow-md transition-shadow"
        >
          <div
            class="absolute top-4 -right-2 w-4 h-4 bg-slate-50 border-b border-r border-slate-100 transform -rotate-45"
          ></div>

          <div
            class="flex-row-reverse flex flex-wrap-reverse items-center justify-between mb-2"
          >
            <div class="flex items-center gap-2">
              <span class="font-bold text-sm text-slate-800 pb-1">
                {{ log.loggerName }}</span
              >
            </div>
            <span class="text-xs text-slate-400">
              {{ log.createdAt | date : "short" }}
            </span>
          </div>

          <div
            class="flex flex-row-reverse text-right items-center p-2 gap-2 flex-wrap"
          >
            <span class="text-sm text-slate-600 pb-1">الحالة</span>
            <p-tag
              [value]="getStatusLabel(log.newStatus)"
              [severity]="getStatusSeverity(log.newStatus!)"
              class="text-center pb-1.5"
            ></p-tag>
          </div>

          <div
            *ngIf="log.action !== 'StatusChange'"
            class="text-slate-700 text-sm leading-relaxed whitespace-pre-wrap"
          >
            {{ log.comment }}
          </div>

          <div
            *ngIf="!log.isPublic"
            class="mt-3 border-t text-center border-slate-200 pt-2 flex items-center gap-1 text-amber-600 text-xs font-bold"
          >
            <i class="pi pi-eye-slash"></i>
            <span>سجل خاص (Admin Only)</span>
          </div>
        </div>
      </div>
    </ng-template>
  </p-timeline>

  <div *ngIf="logs.length === 0" class="text-center py-8 text-slate-400">
    <i class="pi pi-inbox text-4xl mb-2 opacity-50"></i>
    <p>لا يوجد نشاطات مسجلة حتى الآن.</p>
  </div>
</div>
