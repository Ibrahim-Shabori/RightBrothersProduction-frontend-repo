<div class="card border-none shadow-none p-0">
  <p-table
    #dt
    [value]="admins"
    [lazy]="true"
    [loading]="loading"
    (onLazyLoad)="loadAdmins($event)"
    [dataKey]="'id'"
    [totalRecords]="totalRecords"
    [rows]="10"
    [paginator]="true"
    breakpoint="960px"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="عرض {first} إلى {last} من أصل {totalRecords} مشرف"
    responsiveLayout="scroll"
    [rowHover]="true"
    stateKey="review-queue-table"
    styleClass="p-datatable-gridlines p-datatable-sm"
  >
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="text-center p-4 text-500">
          لا يوجد مشرفين يطابقون بحثك.
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>المشرف</th>
        <th style="width: 15%">الدور / الصلاحية</th>
        <th
          pSortableColumn="performance"
          class="text-center"
          style="width: 20%"
        >
          الإنتاجية (سجلات) <p-sortIcon field="performance" />
        </th>
        <th pSortableColumn="lastActivity" style="width: 15%">
          آخر نشاط <p-sortIcon field="lastActivity" />
        </th>
        <th style="width: 140px">إجراءات</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-admin>
      <tr>
        <td>
          <div class="flex items-center gap-3">
            @if (admin.profilePictureUrl != "" && admin.profilePictureUrl !=
            null) {
            <p-avatar
              [image]="getProfilePicturePath(admin.profilePictureUrl)"
              shape="circle"
              size="normal"
              styleClass="font-bold shadow-1"
            >
            </p-avatar>
            } @else {
            <p-avatar
              [label]="getFirstChar(admin.fullName)"
              shape="circle"
              size="normal"
              [style]="{ 'background-color': '#3B82F6', color: '#ffffff' }"
              styleClass="font-bold shadow-1"
            >
            </p-avatar>
            }
            <div class="flex flex-col gap-1">
              <span class="font-bold text-900">
                {{ admin.fullName }}
                <span
                  *ngIf="admin.id === getCurrentUserId()"
                  class="text-500 text-xs font-normal"
                  >(أنت)</span
                >
              </span>
              <span class="text-sm text-500">{{ admin.email }}</span>
            </div>
          </div>
        </td>

        <td>
          <p-tag
            [value]="admin.role === 'SuperAdmin' ? 'مدير نظام' : 'مشرف'"
            [severity]="admin.role === 'SuperAdmin' ? 'warn' : 'info'"
            [icon]="
              admin.role === 'SuperAdmin' ? 'pi pi-crown' : 'pi pi-shield'
            "
            [rounded]="true"
          >
          </p-tag>
        </td>

        <td class="text-center">
          <div class="flex flex-col items-center">
            <span class="text-xl font-bold text-900">{{
              admin.performanceScore
            }}</span>
            <span class="text-xs text-500">تحديث حالة</span>
          </div>
        </td>

        <td>
          <span class="text-700">{{
            admin.lastActivity | date : "shortDate"
          }}</span>
          <div class="text-xs text-500 mt-1">
            {{ admin.lastActivity | date : "shortTime" }}
          </div>
        </td>

        <td>
          <div class="flex gap-2">
            <button
              pButton
              icon="pi pi-id-card"
              class="p-button-text p-button-sm p-button-secondary"
              pTooltip="ملف المشرف"
              tooltipPosition="top"
            ></button>

            <button
              *ngIf="canDemote(admin)"
              pButton
              icon="pi pi-arrow-down"
              class="p-button-text p-button-sm p-button-warning"
              pTooltip="سحب الصلاحيات"
              tooltipPosition="top"
              (click)="openDemoteDialog(admin)"
            ></button>

            <i
              *ngIf="!canDemote(admin)"
              class="pi pi-lock text-300 p-2"
              pTooltip="لا يمكن تعديل هذا المشرف"
            >
            </i>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <app-user-action-dialog
    [(visible)]="displayDialog"
    [user]="selectedAdmin"
    action="demote"
    (onConfirm)="handleDemoteConfirm()"
  >
  </app-user-action-dialog>

  <p-toast position="top-left"></p-toast>
</div>
